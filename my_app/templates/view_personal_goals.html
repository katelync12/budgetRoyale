{% extends "base.html" %} 
{% block content %}
<h2 style="text-align: center; margin-bottom: 15px;">Personal Goals!</h2>
<div class="button-container">
    <button onclick="window.location.href='{% url 'home' %}'">Home</button>
    <button onclick="window.location.href='{% url 'create_personal_goals' %}'">Create</button>
</div>

<div class="table-container">
    
        {% for goal in goals %}
            
        <div>
            <h2 style="text-align: center; justify-content: center;">{{ goal.goal_name }}  </h2>
            <br> <br> <br> <br>
        </div>           
        <div style="margin-top: 10px; width: 400px;">
        
            
            <progress style="width: 90%;" value="33" max="100">
          </div>

                      <div>
                        <i class="fas fa-pencil-alt fa-fw my-own-icon" title="Update" onclick="editPersonalGoal({{ goal.id }})"></i>
                        <i class="fas fa-trash-alt delete-personal-goal" data-goal-id="{{ goal.id }}" data-goal-name="{{ goal.goal_name }}"></i>
                    </div>                                                                      
            
        {% endfor %}
    
</div>
<ul>
</ul>

<script>
    document.querySelectorAll('.delete-personal-goal').forEach(item => {
        item.addEventListener('click', event => {
            const goalId = event.target.dataset.goalId;
            const goalName = event.target.dataset.goalName;
            
            // Prompt user for confirmation
            const isConfirmed = confirm(`Are you sure you want to delete ${goalName} goal?`);
            if (!isConfirmed) {
                return; // Abort deletion if user cancels
            }
            
            fetch(`/delete_goal/${goalId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    // Remove the transaction row from the table
                    event.target.closest('tr').remove();
                } else {
                    console.error('Error deleting transaction:', data.error);
                }
            })
            .catch(error => {
                console.error('Error deleting transaction:', error);
            });
        });
    });
</script>

<script>
    function editPersonalGoal(goalId) {
        window.location.href = `/edit_personal_goal/${goalId}/`;
    }    
</script>

<!--<script>
    function updateProgress(progressBarElement, progressBarMessageElement, progress) {
  progressBarElement.style.width = progress.percent + "%";
  progressBarMessageElement.innerHTML = progress.current + ' of ' + progress.total + ' processed.';
}

var trigger = document.getElementById('progress-bar-trigger');
trigger.addEventListener('click', function(e) {
  var bar = document.getElementById("progress-bar");
  var barMessage = document.getElementById("progress-bar-message");
  for (var i = 0; i < 11; i++) {
    setTimeout(updateProgress, 500 * i, bar, barMessage, {
      percent: 10 * i,
      current: 10 * i,
      total: 100
    })
  }
})
</script>-->

<script>
    function updateProgressBar() {
        // Assuming `sum_of_transaction` and `goal_amount` are available in your Django template context
        var sumOfTransaction = {{ sum_of_transaction }};
        var goalAmount = {{ goal_amount }};
        
        // Calculate completion percentage
        var completionPercentage = (75 / 100) * 100;

        // Update progress bar width
        var progressBar = document.getElementById("progress-bar");
        progressBar.style.width = completionPercentage + "%";

        // Update progress message
        var progressBarMessage = document.getElementById("progress-bar-message");
        progressBarMessage.innerHTML = sumOfTransaction + ' of ' + goalAmount + ' processed.';
    }

    // Call updateProgressBar initially to set the progress bar based on initial values
    updateProgressBar();

    // Optionally, you can periodically update the progress bar in case of changes
    // For example, you can call updateProgressBar every few seconds using setInterval

    // Example:
    // setInterval(updateProgressBar, 5000); // Call updateProgressBar every 5 seconds
</script>
{% endblock %}


