{% block color_picker %}
{% load static %}
<div class="container" style=" padding: 20px; box-shadow: 0px 0px 10px #5B5FC5; border-radius: 10px; background: gainsboro">
  <div class="row">
    <div class="selected-color" id="selected-color" style="{% if color %}background-color: {{ color }};{% endif %}"></div>
    <div class="range-slider">
      <input class="slider" type="range" min="0" max="360" value="{{ hue }}" id="hue-slider">
      <div class="slider-thumb">
        <div class="tooltip"></div>
      </div>
      <div class="progress" style="{% if val %}width: {{ val }};{% endif %}{% if color %} background-color: {{ color }};{% endif %}"></div>
    </div>
  </div>
  <div class="row">
    <button onclick="updateProfileColor()" style="background-color: #5B5FC5; color: #ffffff; border: none; padding: 10px 20px; border-radius: 5px; font-family: Verdana, Geneva, Tahoma, sans-serif; cursor: pointer; display: block; margin: 20px auto;">Update Profile Color</button>
  </div>
</div>

<!-- Inline CSS styles -->
<style>
  .container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    max-height: 200px; /* Adjust as needed */
    max-width: 300px;
    margin: 20px;
  }
  
  .row {
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: center;
    margin-bottom: 20px; /* Adjust as needed */
  }
    .selected-color {
        width: 50px;
        height: 50px;
        margin-left: 10px;
        margin-top: 10px;
        border: 1px solid #ccc;
        border-radius: 50%;
        background-color: hsl(0, 40%, 60%);
        
    }
    .range-slider {
      max-width: 30em;
      position: relative;
      margin-left: 20px;
      margin-right: 20px;
      display: flex;
      height: 10px;
    }
    .range-slider .slider {
      -webkit-appearance: none;
      width: 100%;
      height: 100%;
      border-radius: 4px;

    }
    .range-slider .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 1.7em;
      height: 1.7em;
      cursor: pointer;
      z-index: 3;
      position: relative;

    }
    .range-slider .slider-thumb {
      background: gray;
      position: absolute;
      width: 1.0em;
      height: 1.0em;
      border-radius: 50%;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 2;

    }
    .range-slider .slider-thumb::before {
      content: '';
      position: absolute;
      width: 0.5em;
      height: 0.5em;
      background: #ffffff;
      border-radius: inherit;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
    .range-slider .progress {
      width: 50%;
      height: 10px;
      border-radius: 4px;
      background: rgba(0, 0, 0, 0);
      position: absolute;
      top: 50%;
      left : 0;
      transform: translateY(-50%);
      pointer-events: none;
    }
    @media screen and (max-width: 700px) {
      .neu-range-slider {
        width : 100%;
      }
    }
  </style>
  
  
  <script>
    const hueSlider = document.getElementById('hue-slider');
    const selectedColor = document.getElementById('selected-color');
    const progress1 = document.querySelector('.progress');
    
    function updateColorFromContext(color) {
        // Convert color to HSL
        const rgbColor = color.substring(4, color.length - 1)
            .replace(/ /g, '')
            .split(',');
        const r = parseInt(rgbColor[0]);
        const g = parseInt(rgbColor[1]);
        const b = parseInt(rgbColor[2]);

        const max = Math.max(r, g, b);
        const min = Math.min(r, g, b);
        let h, s, l = (max + min) / 2;

        if (max === min) {
            h = s = 0; // achromatic
        } else {
            const d = max - min;
            s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
            switch (max) {
                case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                case g: h = (b - r) / d + 2; break;
                case b: h = (r - g) / d + 4; break;
            }
            h /= 6;
        }

        // Convert HSL to degrees
        const hue = Math.round(h * 360);

        // Set hue value to slider
        hueSlider.value = hue;

        // Convert hue value to HSL color format (Hue, Saturation, Lightness)
        const hslColor = `hsl(${hue}, 40%, 60%)`;

        // Set the background color of the selected color div and progress bar
        selectedColor.style.backgroundColor = hslColor;
        progress1.style.background = hslColor;

        // Update slider and thumb position
        customSlider();
    }

    hueSlider.addEventListener('input', function() {
        const hue = this.value;
        // Convert hue value to HSL color format (Hue, Saturation, Lightness)
        const hslColor = `hsl(${hue}, 40%, 60%)`;
        // Set the background color of the selected color div
        selectedColor.style.backgroundColor = hslColor;
        progress1.style.background = hslColor;
    });

    function customSlider() {
        console.log("custom slider")
        const slider = document.getElementById('hue-slider');
        const thumb = document.querySelector('.slider-thumb');
        const progress = document.querySelector('.progress');

        const maxVal = slider.getAttribute('max');
        const val = (slider.value / maxVal) * 100 + '%';

        progress.style.width = val;
        thumb.style.left = val;
    }

    hueSlider.addEventListener('input', () => {
        customSlider();
    });

    function rgbToHex(rgb) {
        // Separate the RGB components
        const [r, g, b] = rgb.match(/\d+/g);
        // Convert each component to hexadecimal and concatenate them
        return "#" + ((1 << 24) + (parseInt(r) << 16) + (parseInt(g) << 8) + parseInt(b)).toString(16).slice(1);
    }

    function updateProfileColor() {
        const color = selectedColor.style.backgroundColor;
        // Convert the color to a hexadecimal string
        const hexColor = rgbToHex(color);

        // Convert hue value to HSL color format (Hue, Saturation, Lightness)
        const encodedColor = encodeURIComponent(hexColor);
        // Send a POST request to update the user's profile color
        fetch(`/update_profile_color/?color=${encodedColor}`)
            .then(response => {
                // Handle response
                if (response.ok) {
                    // Profile color updated successfully
                    alert('Profile color updated successfully!');
                } else {
                    // Error handling
                    alert('Failed to update profile color!');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to update profile color!');
            });
    }
    const thumb = document.querySelector('.slider-thumb');
    function setThumbPosition(val) {
      thumb.style.left = val;
    }
    const val = '{{ val }}'; // Get the value from the context
    if (val) {
        setThumbPosition(val);
    }
    // Make thumb draggable without clicking first
    thumb.draggable = true;

    
</script>
{% endblock %}